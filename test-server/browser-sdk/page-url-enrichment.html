<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/amplitude.png" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Page Url Previous Page tracking</title>
  </head>
  <body>
    <h1>Page 1</h1>
    <div>
      When clicking on the button below, it will change the URL to /new-page{n}, without reloading the page. The page
      url enrichment plugin will track this change and augment events with the previous page url.
    </div>
    <button id="navigate">Go to next page</button>
    <div style="margin-top: 20px">This button will navigate back to the previous page.</div>
    <button id="navigate-back">Go back</button>
    <div style="margin-top: 20px">This button will replace the current state with a new state.</div>
    <button id="replace-state">Replace state</button>

    <div style="margin-top: 20px">This button will track a precise event.</div>
    <button id="precise-event">Add to cart</button>

    <script>
      document.getElementById('precise-event').addEventListener('click', function () {
        amplitude.track('Add to cart', {
          price: 100,
        });
      });
    </script>
    <script>
      let counter = 1;
      document.getElementById('navigate').addEventListener('click', function () {
        counter += 1;
        const newUrl = '/new-page' + counter;

        // Push new state to the browser history
        history.pushState({ page: 'new-page' + counter }, 'New Page', newUrl);

        // Optionally, update the content without reloading
        document.querySelector('h1').innerText = 'Page ' + counter;
      });

      document.getElementById('navigate-back').addEventListener('click', function () {
        // go back a page
        history.back();

        counter -= 1;

        // update the content without reloading
        document.querySelector('h1').innerText = 'Page ' + counter;
      });

      document.getElementById('replace-state').addEventListener('click', function () {
        // replace state
        history.replaceState(
          { page: 'new-page' + counter + 'replaced' },
          'New Page',
          '/new-page' + counter + 'replaced',
        );
      });
    </script>
    <script type="module">
      import * as amplitude from '@amplitude/analytics-browser';
      import { pageViewTrackingPlugin } from '@amplitude/plugin-page-view-tracking-browser';
      import { pageUrlEnrichmentPlugin } from '@amplitude/plugin-page-url-enrichment-browser';
      window.amplitude = amplitude;
      const pageViewPlugin = pageViewTrackingPlugin({
        trackHistoryChanges: 'all',
      });
      const pageUrlPlugin = pageUrlEnrichmentPlugin();

      amplitude.init(
        import.meta.env.VITE_AMPLITUDE_API_KEY,
        import.meta.env.VITE_AMPLITUDE_USER_ID || 'amplitude-typescript test user'
      );
      amplitude.add(pageViewPlugin);
      amplitude.add(pageUrlPlugin);
    </script>
  </body>
</html>
