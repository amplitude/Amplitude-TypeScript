<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>cookie isEnabled</title>
</head>
<body>
  <pre id="out"></pre>
  <script type="module">
    import { CookieStorage } from '@amplitude/analytics-core';

    const out = document.getElementById('out');

    function log(msg) {
      out.textContent += msg + '\n';
    }

    async function run() {
      const c1 = new CookieStorage();
      const c2 = new CookieStorage();

      const promises = [
        c1.isEnabled(),
        c2.isEnabled(),
        c1.isEnabled(),
        c2.isEnabled(),
      ];
      const results = await Promise.all(promises);
      const [a, b, c, d] = results;

      log('Parallel calls: ' + JSON.stringify(results));
      log('All true: ' + (a && b && c && d));

      // Test that all of the concurrent calls returned true
      for (const result of results) {
        if (!result) {
          const errorMessage = `isEnabled returned 'false'. Test failed.`;
          console.error(errorMessage);
          throw new Error(errorMessage);
        }
      }
    }

    run();
  </script>
</body>
</html>
